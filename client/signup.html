<!DOCTYPE html>
<html lang="en">

  <head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Shop Homepage - Start Bootstrap Template</title>

    <!-- Bootstrap core CSS -->
    <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="css/common.css" rel="stylesheet">
    <link href="css/login.css" rel="stylesheet">
<!--    <script src="vendor/bootstrap/js/bootstrap-confirmation.min.js"></script>  -->
    <script type="text/javascript" src="vendor/jquery/jquery.js"></script>
    <script src="js/host.js"></script>

  </head>

  <body>

    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
      <div class="container">
        <a class="navbar-brand" href="index.html">Vtattoo</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarResponsive">
          <ul class="navbar-nav ml-auto">
            <li class="nav-item">
                <a id="welcome-msg" class="nav-link" href=""></a>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <!-- End navigation -->

<script>
     $("#error-msg").css("display",  "none");
</script>
<div class="container">

  <div class="row" id="pwd-container">
    <div class="col-md-4"></div>

    <div class="col-md-4">
      <section class="login-form">
        <form method="post" action="http://127.0.0.1:8000/rest-auth/login/" role="login">
          <img src="http://i.imgur.com/RcmcLv4.png" class="img-responsive" alt="" />
          <div id="error-msg" class="alert alert-danger" style="display: none;">
<!--
                <strong>Warning!</strong>
              Indicates a warning that might need attention.
-->
          </div>
          <input type="login" name="login" placeholder="Login" id="login", required class="form-control input-lg" value="" />
          <input type="email" name="email" placeholder="Email" id="email", required class="form-control input-lg" value="" />

          <input type="password" class="form-control input-lg" id="password" placeholder="Password" required="" />

          <input type="password" class="form-control input-lg" id="conf-password" placeholder="Confirm password" required="" />


          <div class="pwstrength_viewport_progress"></div>


          <button id="submitbutton" type="submit" name="go" class="btn btn-lg btn-success btn-block">Sign up</button>

          <div>
            <a href="signin.html"> Already have account? </a>
          </div>

        </form>

      </section>
      </div>
      <div class="col-md-4"></div>
  </div>
</div>

  </body>

</html>

<script>
      var signup_url = addHost_("rest-auth/registration/");
      // var signup_url = "http://127.0.0.1:8000/rest-auth/registration/";
    /* attach a submit handler to the form */

$(document).ready(function(){
               $( "form" ).submit(function(event) {
                  event.preventDefault();
                  localStorage.clear();
                  url = signup_url;
                  username_ = $("#login").val();
                  email_ = $('#email').val();
                  password_ = $('#password').val();
                  confrim_password_ = $('#conf-password').val();
                  console.log(password_);
                  console.log(confrim_password_);
                  if (password_ != confrim_password_) {
                      $("#error-msg").css("display",  "block");
                      $("#error-msg").html("Error! Passwords aren't match.")
                      return;
                  }

                  var posting = $.post( url, {
                      username: username_,
                      email: email_,
                      password1: password_,
                      password2: confrim_password_ }
                  );

                  posting.done(function( data ) {
                      console.log("Signed up with:");
                      console.log(data);
                      $("#error-msg").css("display",  "none");
                      localStorage.name = username_;
                      localStorage.email = email_;
                      // localStorage.password = password_;
                      localStorage.token = data.key;

                      // for successful reistration message
                      localStorage.justRegistered = true;

                      window.location.href = "index.html";
                  });

                  posting.fail(function(data, status, xhr) {
                      $("#error-msg").css("display",  "block");
                      if (xhr == "") {
                          $("#error-msg").html("Error! Server is now unavailable.")
                      } else {
                          $("#error-msg").html("Error! Wrong user data.")
                      }
                  });
                });
})
</script>
